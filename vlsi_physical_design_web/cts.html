<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Clock Tree Synthesis (CTS) Explainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A thematic, single-page educational journey. It starts with 'Why CTS Matters,' progresses through the 'Core Challenges' and the 'Automated Process,' and culminates in 'Advanced Optimization.' A sticky side-navigation allows users to jump between concepts. This structure is chosen to build knowledge logically, from the problem to the solution, using interactive modules to make dense engineering topics digestible and engaging for learners. -->
    <!-- Visualization & Content Choices: Clock Skew -> Goal: Compare -> Viz: Interactive diagram with timing waveforms -> Interaction: Button toggles between low/high skew states, animating the waveform difference -> Justification: Directly visualizes the abstract concept of timing differences. CTS Build Process -> Goal: Organize -> Viz: Animated diagram -> Interaction: Button triggers a staggered animation of buffer and wire placement -> Justification: Shows the step-by-step construction performed by EDA tools. Backward Delay Tracking -> Goal: Explain -> Viz: Interactive grid -> Interaction: Button animates the path calculation from endpoint to source -> Justification: Demystifies the complex optimization algorithm by showing its reverse logic. H-Tree Structure -> Goal: Organize -> Viz: Click-to-build H-Tree -> Interaction: Button adds layers to the fractal-like structure -> Justification: Demonstrates a classic, perfectly balanced clock distribution strategy visually. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F6F4;
            color: #4A4A4A;
        }
        @import url('https://rsms.me/inter/inter.css');
        .nav-link.active {
            background-color: #D4E2D4;
            color: #3E5347;
            font-weight: 600;
        }
        .flop {
            width: 30px;
            height: 40px;
            border: 2px solid #888;
            background-color: #EAEAEA;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            position: relative;
        }
        .flop::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 50%;
            margin-top: -4px;
            border: 4px solid transparent;
            border-right: 4px solid #888;
        }
        .line {
            position: absolute;
            background-color: #A0A0A0;
            transition: all 0.5s ease-in-out;
        }
        .buffer {
            width: 30px;
            height: 30px;
            border: 2px solid #5A8F7B;
            background-color: #D4E2D4;
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .waveform {
            position: relative;
            height: 40px;
            border-left: 2px solid #ccc;
            border-bottom: 2px solid #ccc;
        }
        .clock-edge {
            position: absolute;
            width: 2px;
            height: 100%;
            background-color: #3B82F6;
            transition: transform 0.5s ease-in-out;
        }
        .h-tree-segment {
            position: absolute;
            background-color: #C5A087;
            transition: all 0.5s ease-in-out;
            transform-origin: center;
            opacity: 0;
            transform: scale(0);
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex">
        <aside class="w-64 h-screen sticky top-0 bg-white shadow-md p-4 hidden lg:block">
            <h1 class="text-xl font-bold text-[#5A8F7B] mb-8">CTS Explainer</h1>
            <nav id="desktop-nav" class="space-y-2">
                <a href="#intro" class="nav-link block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">Why CTS Matters</a>
                <a href="#challenge" class="nav-link block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">Core Challenges</a>
                <a href="#process" class="nav-link block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">The Automated Process</a>
                <a href="#optimization" class="nav-link block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">Advanced Optimization</a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-8 md:p-12">
            <section id="intro" class="mb-24 scroll-mt-20">
                <h2 class="text-4xl font-bold mb-4 text-[#5A8F7B]">Why CTS Matters: The Chip's Heartbeat</h2>
                <p class="text-lg text-gray-700 max-w-4xl mb-8">
                    Imagine a modern chip as a city with billions of inhabitants (transistors). The clock signal is the synchronized traffic light system that tells everyone when to move. <strong>Clock Tree Synthesis (CTS)</strong> is the engineering marvel of building this city-wide system, ensuring the 'go' signal arrives at every single intersection at the exact same picosecond. Without perfect CTS, the city descends into chaos, and the chip fails.
                </p>
            </section>

            <section id="challenge" class="mb-24 scroll-mt-20">
                <h2 class="text-3xl font-bold mb-6 text-[#5A8F7B]">Core Challenges</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold text-xl mb-2 text-center">Interactive Demo: Clock Skew</h3>
                    <p class="text-center text-gray-600 mb-6"><strong>Clock Skew</strong> is the timing difference of the clock's arrival at different parts of the chip. A high skew can cause data corruption. Click the button to see its effect on the clock waveforms below.</p>
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div class="relative w-full h-48 border-2 border-gray-200 rounded-lg p-4">
                            <div class="absolute" style="top: 20%; left: 10%;"><div class="flop">FF1</div></div>
                            <div class="absolute" style="top: 60%; left: 10%;"><div class="flop">FF2</div></div>
                            <div class="line" style="height: 2px; width: 0%; top: 32%; left: 20%; background-color: #7895B2;" id="path1"></div>
                            <div class="line" style="height: 2px; width: 0%; top: 72%; left: 20%; background-color: #7895B2;" id="path2"></div>
                        </div>
                        <div>
                            <div>
                                <p class="font-semibold mb-1">FF1 Clock Arrival</p>
                                <div class="waveform"><div id="edge1" class="clock-edge" style="transform: translateX(100px);"></div></div>
                            </div>
                            <div class="mt-4">
                                <p class="font-semibold mb-1">FF2 Clock Arrival</p>
                                <div class="waveform"><div id="edge2" class="clock-edge" style="transform: translateX(100px);"></div></div>
                            </div>
                        </div>
                    </div>
                     <div class="text-center mt-6">
                        <button id="skewBtn" class="bg-[#C5A087] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition w-48">Induce High Skew</button>
                        <p class="mt-2 font-mono">Status: <span id="skewStatus" class="font-bold text-green-600">Low Skew (~2ps)</span></p>
                    </div>
                </div>
            </section>

            <section id="process" class="mb-24 scroll-mt-20">
                <h2 class="text-3xl font-bold mb-6 text-[#5A8F7B]">The Automated Process</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold text-xl mb-2 text-center">Visualizing The Build Process</h3>
                    <p class="text-center text-gray-600 mb-6">EDA tools intelligently insert chains of buffers to create a balanced tree, ensuring the clock signal has enough strength to reach every flip-flop with minimal skew. Click 'Build' to see a simplified animation of this process.</p>
                    <div id="cts-diagram" class="relative w-full h-96">
                        <div class="absolute top-1/2 -left-4 text-center">
                            <div class="w-8 h-8 bg-red-500 rounded-full mx-auto mb-1"></div><p class="font-semibold text-sm">Source</p>
                        </div>
                        <div class="flop" style="position: absolute; top: 5%; right: 5%;">FF</div>
                        <div class="flop" style="position: absolute; top: 30%; right: 5%;">FF</div>
                        <div class="flop" style="position: absolute; top: 65%; right: 5%;">FF</div>
                        <div class="flop" style="position: absolute; top: 90%; right: 5%;">FF</div>
                        
                        <div id="b1" class="buffer opacity-0" style="position: absolute; top: 48%; left: 30%;"></div>
                        <div id="b2" class="buffer opacity-0" style="position: absolute; top: 15%; left: 60%;"></div>
                        <div id="b3" class="buffer opacity-0" style="position: absolute; top: 75%; left: 60%;"></div>

                        <div id="l1" class="line" style="top: 50%; left: 10%; width: 0%; height: 2px;"></div>
                        <div id="l2" class="line" style="top: 20%; left: 40%; width: 2px; height: 0%;"></div>
                        <div id="l3" class="line" style="top: 50%; left: 40%; width: 2px; height: 0%;"></div>
                        <div id="l4" class="line" style="top: 20%; left: 40%; width: 0%; height: 2px;"></div>
                        <div id="l5" class="line" style="top: 80%; left: 40%; width: 0%; height: 2px;"></div>
                        <div id="l6" class="line" style="top: 8%; left: 70%; width: 0%; height: 2px;"></div>
                        <div id="l7" class="line" style="top: 33%; left: 70%; width: 0%; height: 2px;"></div>
                        <div id="l8" class="line" style="top: 68%; left: 70%; width: 0%; height: 2px;"></div>
                        <div id="l9" class="line" style="top: 93%; left: 70%; width: 0%; height: 2px;"></div>
                    </div>
                    <div class="text-center mt-6">
                        <button id="buildTreeBtn" class="bg-[#5A8F7B] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition w-32">Build Tree</button>
                    </div>
                </div>
            </section>

            <section id="optimization" class="scroll-mt-20">
                <h2 class="text-3xl font-bold mb-6 text-[#5A8F7B]">Advanced Optimization</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg mb-12">
                    <h3 class="font-bold text-xl mb-2 text-center">Strategy 1: Minimizing Stages</h3>
                    <p class="text-gray-600 mb-6 text-center max-w-3xl mx-auto">A primary goal is building the tree with as few buffer stages as possible. Fewer stages mean lower latency (faster performance) and less power consumption. To achieve this, tools use a clever technique called <strong>Backward Delay Tracking</strong>.</p>
                    <div id="backward-tracking-grid" class="grid grid-cols-10 gap-1 p-4 bg-gray-50 rounded-lg max-w-2xl mx-auto border"></div>
                    <div class="text-center mt-6">
                        <button id="trackBtn" class="bg-[#4A55A2] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition">Trace Path Backwards</button>
                        <p id="tracking-text" class="text-gray-500 mt-2 h-5 transition-opacity duration-500 opacity-0">Calculating max delay from Flop back to Source...</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold text-xl mb-2 text-center">Strategy 2: The H-Tree</h3>
                    <p class="text-gray-600 mb-6 text-center max-w-3xl mx-auto">For certain designs, a geometric approach called an H-Tree provides a perfectly balanced structure. Its fractal-like pattern ensures the wire length from the center to any endpoint is identical, theoretically resulting in zero skew. Click to build the levels.</p>
                    <div id="h-tree-container" class="relative w-full h-96 bg-gray-50 rounded-lg border"></div>
                    <div class="text-center mt-6">
                        <button id="hTreeBtn" class="bg-[#C5A087] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition">Build H-Tree</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('.nav-link');

            function updateActiveLink() {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (window.scrollY >= sectionTop - 120) {
                        current = section.getAttribute('id');
                    }
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            }
            window.addEventListener('scroll', updateActiveLink);
            updateActiveLink();

            // --- Skew Interaction ---
            const skewBtn = document.getElementById('skewBtn');
            const skewStatus = document.getElementById('skewStatus');
            const path1 = document.getElementById('path1');
            const path2 = document.getElementById('path2');
            const edge1 = document.getElementById('edge1');
            const edge2 = document.getElementById('edge2');
            let isSkewed = true;

            function toggleSkew() {
                isSkewed = !isSkewed;
                if (isSkewed) {
                    skewBtn.textContent = 'Induce High Skew';
                    skewStatus.innerHTML = 'Low Skew <span class="text-gray-500">(~2ps)</span>';
                    skewStatus.classList.remove('text-red-600');
                    skewStatus.classList.add('text-green-600');
                    path1.style.width = '55%';
                    path2.style.width = '55%';
                    edge1.style.transform = 'translateX(100px)';
                    edge2.style.transform = 'translateX(102px)';
                } else {
                    skewBtn.textContent = 'Restore Low Skew';
                    skewStatus.innerHTML = 'High Skew <span class="text-gray-500">(~70ps)</span>';
                    skewStatus.classList.remove('text-green-600');
                    skewStatus.classList.add('text-red-600');
                    path1.style.width = '40%';
                    path2.style.width = '70%';
                    edge1.style.transform = 'translateX(80px)';
                    edge2.style.transform = 'translateX(150px)';
                }
            }
            skewBtn.addEventListener('click', toggleSkew);
            toggleSkew();

            // --- CTS Build Interaction ---
            const buildTreeBtn = document.getElementById('buildTreeBtn');
            let treeBuilt = false;
            const buffers = [document.getElementById('b1'), document.getElementById('b2'), document.getElementById('b3')];
            const lines = {
                l1: { el: document.getElementById('l1'), style: 'width: 22%;' },
                l2: { el: document.getElementById('l2'), style: 'height: 30%; top: 20%;' },
                l3: { el: document.getElementById('l3'), style: 'height: 30%; top: 50%;' },
                l4: { el: document.getElementById('l4'), style: 'width: 22%; top:20%;' },
                l5: { el: document.getElementById('l5'), style: 'width: 22%; top:80%;' },
                l6: { el: document.getElementById('l6'), style: 'width: 25%;' },
                l7: { el: document.getElementById('l7'), style: 'width: 25%;' },
                l8: { el: document.getElementById('l8'), style: 'width: 25%;' },
                l9: { el: document.getElementById('l9'), style: 'width: 25%;' },
            };
            
            function resetTree() {
                buffers.forEach(b => b.style.cssText += 'opacity: 0; transform: scale(0);');
                Object.values(lines).forEach(l => l.el.style.cssText = l.el.style.cssText.replace(/width:.*?;|height:.*?;/, 'width: 0; height: 0;'));
                treeBuilt = false;
                buildTreeBtn.textContent = 'Build Tree';
            }

            buildTreeBtn.addEventListener('click', () => {
                if (treeBuilt) {
                    resetTree();
                    return;
                }
                treeBuilt = true;
                buildTreeBtn.textContent = 'Reset';

                setTimeout(() => { buffers[0].style.cssText += 'opacity: 1; transform: scale(1);'; lines.l1.el.style.cssText += lines.l1.style; }, 100);
                setTimeout(() => { lines.l2.el.style.cssText += lines.l2.style; lines.l3.el.style.cssText += lines.l3.style; }, 300);
                setTimeout(() => { buffers[1].style.cssText += 'opacity: 1; transform: scale(1);'; buffers[2].style.cssText += 'opacity: 1; transform: scale(1);'; lines.l4.el.style.cssText += lines.l4.style; lines.l5.el.style.cssText += lines.l5.style; }, 600);
                setTimeout(() => { Object.values(lines).slice(5).forEach(l => l.el.style.cssText += l.style); }, 900);
            });

            // --- Backward Tracking Interaction ---
            const gridContainer = document.getElementById('backward-tracking-grid');
            const trackBtn = document.getElementById('trackBtn');
            const trackingText = document.getElementById('tracking-text');
            const numCells = 50;
            for (let i = 0; i < numCells; i++) {
                const cell = document.createElement('div');
                cell.className = 'w-full aspect-square border border-gray-200 transition-colors duration-200';
                cell.dataset.index = i;
                if (i === 20) { cell.classList.add('bg-red-500'); cell.title = 'Source'; }
                if (i === 29) { cell.classList.add('bg-blue-500'); cell.title = 'Flop'; }
                gridContainer.appendChild(cell);
            }
            
            let isTracking = false;
            trackBtn.addEventListener('click', () => {
                if(isTracking) return;
                isTracking = true;
                gridContainer.querySelectorAll('div').forEach(c => c.classList.remove('bg-yellow-300'));
                gridContainer.querySelector('[data-index="20"]').classList.add('bg-red-500');
                gridContainer.querySelector('[data-index="29"]').classList.add('bg-blue-500');
                
                trackingText.classList.remove('opacity-0');
                const path = [29, 28, 18, 17, 16, 15, 25, 24, 23, 22, 21, 20];
                let i = 0;
                const interval = setInterval(() => {
                    if (i < path.length) {
                        const cell = gridContainer.querySelector(`[data-index='${path[i]}']`);
                        if(cell) cell.classList.add('bg-yellow-300');
                        i++;
                    } else {
                        clearInterval(interval);
                        setTimeout(() => { trackingText.classList.add('opacity-0'); isTracking = false; }, 1500);
                    }
                }, 150);
            });

            // --- H-Tree Interaction ---
            const hTreeBtn = document.getElementById('hTreeBtn');
            const hTreeContainer = document.getElementById('h-tree-container');
            let hTreeLevel = 0;
            const maxLevels = 3;

            function createSegment(styles) {
                const seg = document.createElement('div');
                seg.className = 'h-tree-segment';
                Object.assign(seg.style, styles);
                hTreeContainer.appendChild(seg);
                return seg;
            }

            function buildHTree(level, x, y, size) {
                if (level > hTreeLevel) return;

                const halfSize = size / 2;
                const x0 = x - halfSize, x1 = x + halfSize;
                const y0 = y - halfSize, y1 = y + halfSize;

                const segments = [
                    createSegment({ left: `${x0}%`, top: `${y}%`, width: `${size}%`, height: '2px', transform: 'translateY(-1px) scale(0)' }),
                    createSegment({ left: `${x0}%`, top: `${y0}%`, width: '2px', height: `${size}%`, transform: 'translateX(-1px) scale(0)' }),
                    createSegment({ left: `${x1}%`, top: `${y0}%`, width: '2px', height: `${size}%`, transform: 'translateX(-1px) scale(0)' })
                ];
                
                setTimeout(() => segments.forEach(s => Object.assign(s.style, { opacity: 1, transform: s.style.transform.replace('scale(0)', 'scale(1)') })), 100);

                const newSize = size / 2;
                buildHTree(level + 1, x0, y0, newSize);
                buildHTree(level + 1, x0, y1, newSize);
                buildHTree(level + 1, x1, y0, newSize);
                buildHTree(level + 1, x1, y1, newSize);
            }
            
            hTreeBtn.addEventListener('click', () => {
                hTreeLevel = (hTreeLevel + 1) % (maxLevels + 1);
                hTreeContainer.innerHTML = '';
                if (hTreeLevel > 0) {
                    buildHTree(1, 50, 50, 50);
                    hTreeBtn.textContent = `Build Level ${hTreeLevel + 1 > maxLevels ? 1 : hTreeLevel + 1}`;
                } else {
                    hTreeBtn.textContent = 'Build H-Tree';
                }
            });
        });
    </script>
</body>
</html>

